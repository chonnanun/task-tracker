<style type="text/css">
    .lastupdated td {
        background-color: #dcffd9;
        font-weight: bold;
        color: #129e02;
        transition: background-color 1s linear;
    }

    .quickassign {
        width: 60%;
    }

    .lastupdated {
        background-color: #94ea9e;
    }

    span.colorbar-default {
        display: inline-block;
        padding: 2px;
        background-color: #eaeaea;
        width: 100%;
        text-align: center;
    }

    .row-RLSE td {
        background-color: #e3ffd7;
    }

    .row-Pending td {
        background-color: rgba(255, 255, 192, 0.88);
    }

    .oversla {
        background-color: #FF0000 !important;
        color: #FFF;
    }

    input[type="search"] {
        width: 300px;
    }

    table {
      width: 100%;
      overflow-x: scroll;
      overflow-y: auto;
  }

  th {
    padding: 6px !important;
}

/* Custom column*/
th.cust-causes {
    min-width: 200px;
}
th.cust-othercause.sorting {
    min-width: 200px;
}

th.custcols {
    min-width: 100px;
}

th.cust-shift {
    min-width: 20px;
}

th.cust-CAT {
    min-width: 20px;
}

th.default-assign {
    min-width: 160px;
}
.whitebar {
    background-color: #fffb81 !important;
    border-top: #bfbfbf solid 2px;
}

table.ui-datepicker-calendar td {
    text-align: center;
}

div#ui-datepicker-div {
    background-color: #ffca00;
    padding: 20px;
}

td.ui-datepicker-current-day {
    background-color: #ffe78c;
    border: #e42828 solid 1px;
}

td.ui-datepicker-today {
    background-color: #f3ff8c;
}

a.ui-datepicker-next.ui-corner-all {
    text-align: right;
    float: right;
}

.ui-datepicker-title {
    text-align: center;
    font-size: 20px;
}

table.ui-datepicker-calendar td a {
    color: #c70000;
    font-weight: bold;
}
thead {
    background-color: #d0cfca;
}

.tablealert {
    background-color: rgba(255, 203, 5, 0.26);
}

#reporttbl tbody tr:hover {
    background-color: #ffe8a6 !important;
}

li.sumlist {
    float: left;
    list-style: none;
    width: 90x;
    text-align: center;
    background-color: #e2e2e2;
    padding: 10px;
    margin: 2px;
}

span.smallsummary {
    font-size: 5px;
    display: block;
}

h2.numsummary {
    padding: 0px;
    margin: 0px;
    text-align: center;
    font-size: 19px;
    font-weight: bold;
}

li.sumdatelist {
    list-style: none;
    width: 100px;
    text-align: center;
    font-size: 14px;
    display: block;
    background-color: #ffcb05;
    float: left;
    padding: 10px;
}

/* loading animate*/
#fountainG{
    position:relative;
    width:234px;
    height:28px;
    margin:auto;
    margin-bottom: 20px;
}

.fountainG{
    position:absolute;
    top:0;
    background-color:rgba(235,189,52,0.82);
    width:28px;
    height:28px;
    animation-name:bounce_fountainG;
    -o-animation-name:bounce_fountainG;
    -ms-animation-name:bounce_fountainG;
    -webkit-animation-name:bounce_fountainG;
    -moz-animation-name:bounce_fountainG;
    animation-duration:0.715s;
    -o-animation-duration:0.715s;
    -ms-animation-duration:0.715s;
    -webkit-animation-duration:0.715s;
    -moz-animation-duration:0.715s;
    animation-iteration-count:infinite;
    -o-animation-iteration-count:infinite;
    -ms-animation-iteration-count:infinite;
    -webkit-animation-iteration-count:infinite;
    -moz-animation-iteration-count:infinite;
    animation-direction:normal;
    -o-animation-direction:normal;
    -ms-animation-direction:normal;
    -webkit-animation-direction:normal;
    -moz-animation-direction:normal;
    transform:scale(.3);
    -o-transform:scale(.3);
    -ms-transform:scale(.3);
    -webkit-transform:scale(.3);
    -moz-transform:scale(.3);
    border-radius:19px;
    -o-border-radius:19px;
    -ms-border-radius:19px;
    -webkit-border-radius:19px;
    -moz-border-radius:19px;
}

#fountainG_1{
    left:0;
    animation-delay:0.286s;
    -o-animation-delay:0.286s;
    -ms-animation-delay:0.286s;
    -webkit-animation-delay:0.286s;
    -moz-animation-delay:0.286s;
}

#fountainG_2{
    left:29px;
    animation-delay:0.3525s;
    -o-animation-delay:0.3525s;
    -ms-animation-delay:0.3525s;
    -webkit-animation-delay:0.3525s;
    -moz-animation-delay:0.3525s;
}

#fountainG_3{
    left:58px;
    animation-delay:0.429s;
    -o-animation-delay:0.429s;
    -ms-animation-delay:0.429s;
    -webkit-animation-delay:0.429s;
    -moz-animation-delay:0.429s;
}

#fountainG_4{
    left:88px;
    animation-delay:0.4955s;
    -o-animation-delay:0.4955s;
    -ms-animation-delay:0.4955s;
    -webkit-animation-delay:0.4955s;
    -moz-animation-delay:0.4955s;
}

#fountainG_5{
    left:117px;
    animation-delay:0.572s;
    -o-animation-delay:0.572s;
    -ms-animation-delay:0.572s;
    -webkit-animation-delay:0.572s;
    -moz-animation-delay:0.572s;
}

#fountainG_6{
    left:146px;
    animation-delay:0.6385s;
    -o-animation-delay:0.6385s;
    -ms-animation-delay:0.6385s;
    -webkit-animation-delay:0.6385s;
    -moz-animation-delay:0.6385s;
}

#fountainG_7{
    left:175px;
    animation-delay:0.715s;
    -o-animation-delay:0.715s;
    -ms-animation-delay:0.715s;
    -webkit-animation-delay:0.715s;
    -moz-animation-delay:0.715s;
}

#fountainG_8{
    left:205px;
    animation-delay:0.7815s;
    -o-animation-delay:0.7815s;
    -ms-animation-delay:0.7815s;
    -webkit-animation-delay:0.7815s;
    -moz-animation-delay:0.7815s;
}



@keyframes bounce_fountainG{
    0%{
        transform:scale(1);
        background-color:rgb(240,179,24);
    }

    100%{
        transform:scale(.3);
        background-color:rgb(255,255,255);
    }
}

@-o-keyframes bounce_fountainG{
    0%{
        -o-transform:scale(1);
        background-color:rgb(240,179,24);
    }

    100%{
        -o-transform:scale(.3);
        background-color:rgb(255,255,255);
    }
}

@-ms-keyframes bounce_fountainG{
    0%{
        -ms-transform:scale(1);
        background-color:rgb(240,179,24);
    }

    100%{
        -ms-transform:scale(.3);
        background-color:rgb(255,255,255);
    }
}

@-webkit-keyframes bounce_fountainG{
    0%{
        -webkit-transform:scale(1);
        background-color:rgb(240,179,24);
    }

    100%{
        -webkit-transform:scale(.3);
        background-color:rgb(255,255,255);
    }
}

@-moz-keyframes bounce_fountainG{
    0%{
        -moz-transform:scale(1);
        background-color:rgb(240,179,24);
    }

    100%{
        -moz-transform:scale(.3);
        background-color:rgb(255,255,255);
    }
}

.tableloading {
    opacity: 0.2;
}

.modal-dialog {
    width: 80% !important;
}

.modal {
    background: rgba(255, 255, 255, 0.71);
}
.content-wrapper, .right-side {
    min-height: 100%;
    background-color: #ffffff;
    z-index: 800;
}

.modal-header {
    background-color: #e48105;
    text-align: center;
    color: #FFFFFF;
}
.dt-button{
    vertical-align:middle;
}
</style>

<div class="content-wrapper">

<section class="content">
    <div class="row">
        <div class="col-xs-3">
            <fieldset>
                <legend><?= $groupName; ?></legend>
            </fieldset>
            <div class="form-group">
                <label>Report Monthly</label>
                <select id="report_year">
                    <option value="2016" <?php if(date('Y') == "2016") echo "selected"; ?>>2016</option>
                    <option value="2017" <?php if(date('Y') == "2017") echo "selected"; ?>>2017</option>
                    <option value="2018" <?php if(date('Y') == "2018") echo "selected"; ?>>2018</option>
                    <option value="2019" <?php if(date('Y') == "2019") echo "selected"; ?>>2019</option>
                    <option value="2020" <?php if(date('Y') == "2020") echo "selected"; ?>>2020</option>
                </select>

                <select id="report_month">
                    <option value="01" <?php if(date('m') == "1") echo "selected"; ?>>01</option>
                    <option value="02" <?php if(date('m') == "2") echo "selected"; ?>>02</option>
                    <option value="03" <?php if(date('m') == "3") echo "selected"; ?>>03</option>
                    <option value="04" <?php if(date('m') == "4") echo "selected"; ?>>04</option>
                    <option value="05" <?php if(date('m') == "5") echo "selected"; ?>>05</option>
                    <option value="06" <?php if(date('m') == "6") echo "selected"; ?>>06</option>
                    <option value="07" <?php if(date('m') == "7") echo "selected"; ?>>07</option>
                    <option value="08" <?php if(date('m') == "8") echo "selected"; ?>>08</option>
                    <option value="09" <?php if(date('m') == "9") echo "selected"; ?>>09</option>
                    <option value="10" <?php if(date('m') == "10") echo "selected"; ?>>10</option>
                    <option value="11" <?php if(date('m') == "11") echo "selected"; ?>>11</option>
                    <option value="12" <?php if(date('m') == "12") echo "selected"; ?>>12</option>

                </select>

                <button onclick='goReport(event);'>report</button>
                <button onclick=''>graph</button>
                
                <a href="#" target="_blank" class="dt-button excel-report" data-cat="3">Cat Excel Report</a>
            </div>

            <script type="text/javascript">
                $(function(){
                    $('.excel-report').click(function(){
                        var year = $('#report_year').val();
                        var month = $('#report_month').val();
                        var cat = $(this).data('cat');
                        var href = '<?php echo base_url()."task/reportExcelMonthly" ?>?year='+year+'&month='+month+'&cat='+cat;
                        $(this).attr('href',href);
                        return true;
                    });
                });
                function goReport(event) {
                    event.preventDefault();
                    year = $('#report_year').val();
                    month = $('#report_month').val();
                    window.open("<?php echo base_url()."tasks/report/monthly/"; ?>"+year+"/"+month, "_blank", "toolbar=no,scrollbars=yes,resizable=no,top=100,left=100,width=900,height=600");
                }
            </script>

        </div>

        <div class="col-xs-6 text-center">
            <div class="form-group">
                <fieldset>
                    <legend>Filter</legend>

                    From | จาก: <input type="text" id="datepicker1" value="<?= date('Y-m-d',strtotime("last week")) ?>" style="width: 90px;">
                    To | ถึง: <input type="text" id="datepicker2" value="<?= date('Y-m-d',strtotime("now")) ?>" style="width: 90px;">
                    <input type="checkbox" name="onlypending" id="onlypending" value="pending" <?php if($status=='pending') { echo " checked"; } ?>> แสดงเฉพาะงานที่ยังไม่เสร็จเท่านั้น
                    <a class="btn btn-default" href="#" onclick='filter(event);' style="background-color: #ffcb05;">Filter</a>
                </fieldset>
            </div>
        </div>


        <div class="col-xs-3 text-center">
            <div class="form-group">
                <fieldset>
                    <legend>Add / เพิ่มใหม่</legend>
<!--                     <a class="btn btn-primary" href="<?php echo base_url(); ?>task/addNew">Add New</a>

    <a class="btn btn-success" href="#" onclick='linkopen(event);'>Easy Add</a> -->

<!--     <a class="btn btn-warning" href="#" onclick='linkopen2(event);'>Add งานใหม่</a> -->
    <button class="btn btn-warning" data-toggle="modal" data-target="#myModal" id="newadd">New Add งานใหม่</button>
    </fieldset>
</div>

</div>
</div>

<?php
if(!empty($filter)) { 
    ?>
    <script type="text/javascript">
        $('#datepicker1').val("<?= $filter['from'] ?>");
        $('#datepicker2').val("<?= $filter['to'] ?>");
    </script>
    <?php } ?>


    <script>

        // $( function() {
        //     $( "#datepicker" ).datepicker();
        //   } );

        $('#datepicker1').keypress(function (e) {
          if (e.which == 13) {
            filter();
            return false;    //<---- Add this line
        }
    });
        $('#datepicker2').keypress(function (e) {
          if (e.which == 13) {
            filter();
            return false;    //<---- Add this line
        }
    });



        function filter() {
            from = $('#datepicker1').val();
            to = $('#datepicker2').val();
            if($('#onlypending').prop( "checked" )) {
                status = $('#onlypending').val();
            } else {
                status = 'all';
            }
            //url = "<?php //echo base_url()?>tasks/1/"+from+"/"+to+"/"+status+"?"+"<?php // echo $_SERVER['QUERY_STRING'] ?>";
            url = "<?= base_url()?>tasks/1/"+from+"/"+to+"/"+status+"?"+"task=showall";
            // console.log(url);
            window.location.href = url;
        }


        function linkopen(event) {
            event.preventDefault();
            window.open("<?php echo base_url()."task/addNew?mode=easy"; ?>", "_blank", "toolbar=yes,scrollbars=yes,resizable=yes,top=100,left=100,width=400,height=600");
        }

        function linkopen2(event) {
            event.preventDefault();

            window.open("<?php echo base_url()."task/addNewBatch"; ?>", "_blank", "toolbar=yes,scrollbars=yes,resizable=yes,top=100,left=100,width=400,height=600");
        }
    </script>


    <!-- Today Task List-->

    <?php //print_r($customfields); ?>
    <!-- All Task List-->
    <div class="row allbox boxen">
        <div class="col-xs-12">
            <div class="box">
                <div class="box-header">
                    <h3 class="box-title">
                      <!--                   งานทั้งหมด -->
                      <span style="float: right;">
                        <ul class="sumlists" style="">
                            <li class="sumdatelist"><span class="glyphicon glyphicon-time"></span>
                                <br><?= date('d/m/Y',strtotime($filter['fromsummary'])) ?> ถึง <?= date('d/m/Y',strtotime($filter['to'])) ?></li>

                                <li class="sumlist"><span class="glyphicon glyphicon-list-alt"></span>
                                    <span class="smallsummary">all</span>
                                    <h2 class="numsummary">
                                        <a href="<?= base_url()?>tasks/1/<?= $filter['fromsummary'] ?>/<?= $filter['to'] ?>/all?task=showall"><?= $summary[0]->total ?></a></h2>
                                    </li>

                                    <li class="sumlist"><span class="glyphicon glyphicon-ok-circle">
                                    </span><span class="smallsummary">released</span>
                                    <h2 class="numsummary">
                                        <a href="<?= base_url()?>tasks/1/<?= $filter['fromsummary'] ?>/<?= $filter['to'] ?>/released?task=showall"><?= $summary[0]->RLSE ?></a></h2>
                                    </li>

                                    <li class="sumlist">> JPV
                                    </span><span class="smallsummary">Pass JPV</span>
                                    <h2 class="numsummary">
                                        <a href="<?= base_url()?>tasks/1/<?= $filter['fromsummary'] ?>/<?= $filter['to'] ?>/passjpv?task=showall"><?= $summary[0]->PassJPV ?></a></h2>
                                    </li>

                                    <li class="sumlist">> ECE(v)
                                    </span><span class="smallsummary">Pass EsyClr(v)</span>
                                    <h2 class="numsummary">
                                        <a href="<?= base_url()?>tasks/1/<?= $filter['fromsummary'] ?>/<?= $filter['to'] ?>/passeasy?task=showall"><?= $summary[0]->PassEASY ?></a></h2>
                                    </li>

                                    <li class="sumlist">> CSQ
                                    </span><span class="smallsummary">Pass CSQ</span>
                                    <h2 class="numsummary">
                                        <a href="<?= base_url()?>tasks/1/<?= $filter['fromsummary'] ?>/<?= $filter['to'] ?>/passcsq?task=showall"><?= $summary[0]->PassCQL ?></a></h2>
                                    </li>
									
                                    <li class="sumlist"><span class="glyphicon glyphicon-user">
                                    </span><span class="smallsummary">รอเจ้าหน้าที่</span>
                                    <h2 class="numsummary">
                                        <a href="<?= base_url()?>tasks/1/<?= $filter['fromsummary'] ?>/<?= $filter['to'] ?>/waitagent?task=showall"><?= $summary[0]->WaitAgent ?></a></h2>
                                    </li>

                                    <li class="sumlist"><span class="glyphicon glyphicon-user">
                                    </span><span class="smallsummary">รอลูกค้า</span>
                                    <h2 class="numsummary">
                                        <a href="<?= base_url()?>tasks/1/<?= $filter['fromsummary'] ?>/<?= $filter['to'] ?>/waitcustomer?task=showall"><?= $summary[0]->WaitCustomer ?></a></h2>
                                    </li>


                                </ul>
                            </span>
                        </h3>
                        <div class="box-tools">
                            <form action="<?php echo base_url() ?>taskListing" method="POST" id="searchList">
                                <div class="input-group" style="display: none;">
                                    <input type="text" name="searchText" value="<?php echo $searchText; ?>" class="form-control input-sm pull-right" style="width: 150px;" placeholder="Search"/>
                                    <div class="input-group-btn">
                                        <button class="btn btn-sm btn-default searchList"><i class="fa fa-search"></i></button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div><!-- /.box-header -->
                    <div class="box-body table-responsive no-padding">
                      <div class="alert alert-default tablealert" role="alert">
                          <span class="glyphicon glyphicon-bullhorn" aria-hidden="true"></span>
                          <span class="sr-only">Info:</span>
                          <strong>[12/06/2017] เพิ่มฟิลด์ "วันนำเข้า" และฟังก์ชั่นค้นหาเลขที่ HWB มุมบนขวา สามารถค้นหาจาก HWB หรือส่วนหนึ่งของ HWB (เช่นเลข 4 ตัวท้าย) โดยการพิมพ์แล้วกด Enter หรือโดยการใช้ปืนสแกน โดยไม่ต้องรอให้โหลดเสร็จ</strong>
                          <br>
                          <span class="glyphicon glyphicon-bullhorn" aria-hidden="true"></span>
                          [08/06/2017] ได้ทำการปรับเปลี่ยนการแสดงผลในหน้าตารางเป็นข้อมูล 3 วันย้อนหลังเพื่อแก้ปัญหาแสดงผลช้า หากไม่เจองานที่ค้นหาหรืองานที่ค้นหาเก่ากว่า 3 วัน ให้เลือกวันที่ (From - จาก) ในส่วน Filter ด้านบนเป็นวันที่ต้องการ และกด Filter
                      </div>

                       <?php
                            if(!empty($addresult)) {
                                if(array_key_exists("edited", $addresult)) {
                        ?>

                        <div class="alert alert-danger tablealert" role="alert">
                        Updated successful / แก้ไขสำเร็จ
                            <ul style="display: inline-flex;">
                                <?php 
                                    foreach ($addresult['duplicate'] as $key => $value) {
                                ?>
                                    <li style="float: left; margin-right: 20px;"><a href="#" onclick="linkedit(<?= $value ?>);"> <?= $key ?></a></li>
                                <?php
                                    }
                                ?>
                            </ul>
                        </div>
                        <?php } } ?>

                        <?php
                            if(!empty($addresult)) {
                                if(array_key_exists("duplicate", $addresult)) {
                        ?>

                        <div class="alert alert-danger tablealert" role="alert">
                        Duplicate list / บันทึกไม่สำเร็จเนื่องจากมีข้อมูลอยู่แล้ว :
                            <ul style="display: inline-flex;">
                                <?php 
                                    foreach ($addresult['duplicate'] as $key => $value) {
                                ?>
                                    <li style="float: left; margin-right: 20px;"><a href="#" onclick="linkedit(<?= $value ?>);"> <?= $key ?></a></li>
                                <?php
                                    }
                                ?>
                            </ul>
                        </div>
                        <?php } if(array_key_exists("success", $addresult)) { ?>
                        <div class="alert alert-success tablealert" role="alert">
                        Success list / บันทึกสำเร็จ:
                            <ul style="display: inline-flex;">
                                <?php 
                                    foreach ($addresult['success'] as $key => $value) {
                                ?>
                                    <li style="float: left; margin-right: 20px;"><a href="#" onclick="linkedit(<?= $value ?>);"> <?= $key ?></a></li>
                                <?php
                                    }
                                ?>
                            </ul>
                        </div>


                        <?php
                            } }
                        ?>


                      <div style="background-color: #FFF;" class="loading">
                        <div id="fountainG">
                            <div id="fountainG_1" class="fountainG"></div>
                            <div id="fountainG_2" class="fountainG"></div>
                            <div id="fountainG_3" class="fountainG"></div>
                            <div id="fountainG_4" class="fountainG"></div>
                            <div id="fountainG_5" class="fountainG"></div>
                            <div id="fountainG_6" class="fountainG"></div>
                            <div id="fountainG_7" class="fountainG"></div>
                            <div id="fountainG_8" class="fountainG"></div>
                        </div>
                    </div>


                    <table class="table table-hover display tableloading" id="reporttbl">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th>Title / HWB</th>
                                <th>Status</th>
                                <th style="min-width: 120px;">Description</th>
                                <th style="min-width: 80px;">Created Date</th>

                                <th style="min-width: 80px;">Last update</th>
                                <th style="min-width: 80px;">SLA date</th>
                                <th class="default-cats">Category</th>
                                <th class="default-assign">Assigned To</th>
                                <th class="default-assign">Assigned To</th>
                                <th style="width: 1px; display: none"></th>

                                <?php
                                foreach($customfileds_head as $field )
                                { 
                                    ?>
                                    <th class="custcols cust-<?= $field ?>"><?= $function->showKey($field) ?></th>
                                    <?php
                                }
                                ?>


                            </tr>
                        </thead>
                        <tbody>
                            <?php
                            if(!empty($taskRecords))
                            {
                                foreach($taskRecords as $record)
                                {
                                    $lastupdated = '-';
                                    $oversla = "";
                                    if(!empty($record->sla)) {
                                        $created_date = date('d-m-Y H:m', strtotime($record->created_at));
                                        $SLADate = date('d-m-Y',strtotime(("+".$record->sla." day"), strtotime($record->created_at)));
                                    } else {
                                        $created_date = date('d-m-Y H:m', strtotime($record->created_at));
                                        $SLADate =  "NO SLA";
                                    }

                                    if(!empty($record->last_updated)) {
                                        $lastupdated = date('d-m-Y H:m', strtotime($record->last_updated));
                                    }

                                    ?>
                                    <tr id="row-<?php echo $record->id ?>" class="row-<?php echo $record->statusName ?>">
                                        <td>
                                            <?php 
                                            if (new DateTime() > new DateTime(date('Y-m-d',strtotime(("+".$record->sla." day"), strtotime($record->created_at))))) {
                                                $oversla = "oversla";
                                                ?>
                                                <i class="ion ion-alert-circled"></i>
                                                <?php
                                            }
                                            ?>
                                            <a href="#" onclick='linkedit(<?php echo $record->id ?>);'><?php echo $record->id ?></a>
                                            
                                        </td>
                                        <td><a href="#" onclick='linkedit(<?php echo $record->id ?>);'><?php echo $record->title ?></a></td>
                                        <td><?php echo $record->statusName ?>/<span id="cause-bar2-<?php echo $record->id ?>"></span>/<?php echo mb_substr($record->description, 0, 60, 'UTF-8'); ?></td>
                                        <td>
                                            <span class="colorbar-default"><?php echo $record->statusName ?></span>
                                            <span class="colorbar-default whitebar small" id="cause-bar-<?php echo $record->id ?>"></span>
                                            <?php echo mb_substr($record->description, 0, 60, 'UTF-8'); ?></td>
                                            <td><?php echo $created_date ?></td>
                                            <td><?php echo $lastupdated ?></td>
                                            <td><span class="colorbar-default <?= $oversla ?>"><?php echo $record->sla ?></span><?= $SLADate ?></td>
                                            <td><?php echo $record->cat_name ?></td>
                                            <td id="assigned-<?php echo $record->id ?>">
                                                <?php if($role <=3) { ?>
                                                <a href="#"><i class="ion ion-person-add" onclick='assigned(<?php echo $record->id ?>);'></i>&nbsp;&nbsp;&nbsp;</a>
                                                <?php } ?>
                                                <span id="now-user-<?php echo $record->id ?>" onclick='assigned(<?php echo $record->id ?>);'><?php echo $record->assigned ?></span>
                                                <div id="new-user-<?php echo $record->id ?>" style="display: none;">
                                                    <?php if(true) { ?>
                                                    <select id="select-new-<?php echo $record->id ?>">
                                                        <?php foreach ($users as $user): //print_r($user); ?>
                                                            <option value="<?= $user->userId ?>"
                                                                <?php if($user->userId == $record->assigned_to) { ?>
                                                                selected
                                                                <?php } ?>
                                                                ><?= $user->name ?></option>
                                                            <?php endforeach ?>>
                                                        </select>
                                                        <?php } ?>
                                                        <br>
                                                        <button class="btn btn-success btn-xs" onclick='doAssign(<?php echo $record->id ?>);'>save</button>
                                                        <button class="btn btn-default btn-xs cancleassign">cancel</button>
                                                    </div>
                                                </td>
                                                <td><?php echo $record->assigned ?></td>
                                                <td style="display:none "></td>
                                                <?php
                                                $cause = '';
                                                foreach($customfileds_head as $field )
                                                { 
                                                    $data = json_decode($record->addonstatus,true);
                                                    if(isset($data[$field])) {
                                                        $cust_field = $data[$field];
                                                        //console.log("f="+$field);
                                                        if($field == 'causes') {
                                                            //console.log($field);
                                                            $cause = ($data[$field]== 0)?" ":$data[$field];
                                                        } else if($field == 'othercause') {
                                                            $otcause = $data[$field];
                                                        } else if (in_array($field,["paidby","chequeStatus","dutyPaidby","dutyChequeStatus","causesOld"])
                                                                && $cust_field == '0'){
                                                            $cust_field = '';
                                                        }
                                                    }
                                                    else
                                                        $cust_field = "";
                                                    ?>
                                                    <td><?= $cust_field ?></td>
                                                    <?php
                                                }
                                                ?>
                                                <script type="text/javascript">
                                                    $('#cause-bar-<?php echo $record->id ?>').html("<?= $cause ?> <?= $otcause ?>");
                                                    $('#cause-bar2-<?php echo $record->id ?>').html("<?= $cause ?> <?= $otcause ?>");
                                                </script>
                                            </tr>
                                            <?php
                                        }
                                    }
                                    ?>
                                </tbody>
                            </table>

                        </div><!-- /.box-body -->
                        <div class="box-footer clearfix">
                            <?php echo $this->pagination->create_links(); ?>
                        </div>
                    </div><!-- /.box -->
                </div>
            </div>
        </section>
    </div>



    <!-- Modal -->
    <div id="myModal" class="modal fade" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">เพิ่มงานใหม่</h4>
        </div>
        <div class="modal-body">
            <p>Please wait / รอสักครู่</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
    </div>

</div>
</div>


<div id="myModalEdit" class="modal fade" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">อัพเดตงาน</h4>
        </div>
        <div class="modal-body">
            <p>Please wait / รอสักครู่</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
    </div>

</div>
</div>

<script type="text/javascript">

    $(document).ready(function() {
        // $('#modal-content').modal('show');
        $('#myModal').on('shown.bs.modal', function() {
             $('#myModal').find('.modal-body').load("<?= base_url() ?>task/addNewBatchModal");
        });

    });

</script>


<script>
    function assigned(id) {
        event.preventDefault();

        <?php if($role >=4) { ?>
                // alert("you have no permission to change task owner. ต้องเป็น Supervisor ขึ้นไปเท่านั้น");
                exit();
                <?php } ?>

                now = $('#assigned-'+id).html();
                $('#now-user-'+id).hide();
                $('#new-user-'+id).show();


            // alert(now);


            // window.open("<?php //echo base_url()."task/addNew?mode=easy"; ?>", "_blank", "toolbar=yes,scrollbars=yes,resizable=yes,top=100,left=100,width=400,height=600");
        }

        function doAssign(id) {
            newuser = $('#select-new-'+id).find(":selected").val();
            newusertxt = $('#select-new-'+id).find(":selected").text();
            $.ajax({
             type: "GET",
             url: "<?php echo base_url() ?>assignTask/"+id+"/"+newuser,
             success: function(result){
                $('#new-user-'+id).hide();
                $('#now-user-'+id).html(newusertxt).show().addClass('lastupdated');

            }
        });
        }

        $('.cancleassign').click(function(){
            $(this).parent().hide();
            $(this).parent().siblings().show();
        });


        function linkedit(id) {
            event.preventDefault();
            $('#myModalEdit').modal('show').find('.modal-body').load("<?php echo base_url()."task/quickview/"; ?>"+id);
            // window.open("<?php echo base_url()."task/view/"; ?>"+id, "_blank", "toolbar=yes,scrollbars=yes,resizable=yes,top=100,left=100,width=1050,height=600");
        }

    </script>

    <script type="text/javascript" src="<?php echo base_url(); ?>assets/js/common.js" charset="utf-8"></script>
    <script type="text/javascript">
        jQuery(document).ready(function(){
            jQuery('ul.pagination li a').click(function (e) {
                e.preventDefault();
                var link = jQuery(this).get(0).href;
                var value = link.substring(link.lastIndexOf('/') + 1);
                jQuery("#searchList").attr("action", baseURL + "taskListing/" + value);
                jQuery("#searchList").submit();
            });




            jQuery('.deleteTaskBtn').click(function(){
                var taskId = $(this).data("taskid"),
                hitURL = baseURL + "tasks/deleteTask",
                currentRow = $(this);

                var confirmation = confirm("Are you sure to delete task? คุณต้องการลบ? การลบนี้จะถูกบันทึกลงระบบ กด OK หากยืนยัน");

                if(confirmation)
                {
                    jQuery.ajax({
                        type : "POST",
                        url : hitURL,
                        data : { taskId : taskId }
                    }).done(function(data){
                        currentRow.parents('tr').remove();
                        if(data.status = true) { alert("Successfully deleted"); }
                        else if(data.status = false) { alert("Deletion failed"); }
                        else { alert("Access denied..!"); }
                    });
                }

            });

        });
    </script>
    <?php if(isset($_GET["updated"])){ ?>
    <script type="text/javascript">
        jQuery('#row-<?= $_GET["updated"] ?>').addClass("lastupdated");
    </script>
    <?php } ?>

    <?php if(isset($_GET["task"]) && $_GET["task"] == 'today'){ ?>
    <script type="text/javascript">
        jQuery('.boxen').hide();
        jQuery('.todaybox').show();
    </script>
    <?php } else if(isset($_GET["task"]) && $_GET["task"] == 'all'){ ?>
    <script type="text/javascript">
        jQuery('.boxen').hide();
        jQuery('.allbox').show();
    </script>
    <?php } else if(isset($_GET["task"]) && $_GET["task"] == 'done'){ ?>
    <script type="text/javascript">
        jQuery('.boxen').show();
        // jQuery('.todaybox').show();
    </script>
    <?php } ?>


<!--     <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script> -->

    <script type="text/javascript">

            // var $j = jQuery.noConflict();
            $("#datepicker1").datepicker({
              dateFormat: "yy-mm-dd"
          });

            $("#datepicker2").datepicker({
              dateFormat: "yy-mm-dd"
          });

            $('body').removeClass().addClass('skin-blue sidebar-mini sidebar-collapse');



        </script>

        <script type="text/javascript">


            $(document).ready(function() {

                $('.loading').hide();
                $( "table" ).removeClass( "tableloading" );

                $('#reporttbl thead th').each( function () { 
                    var title = $(this).text();
                    $(this).html( title + '<input type="text" placeholder=" '+title+'" style="width:100%; background-color: #ecf0f5; font-size: 10px;" />' );
                } );


                var table = $('#reporttbl').DataTable( {
                    "aLengthMenu": [[25, 50, 75, -1], [25, 50, 75, "All"]],
                    "order": [[ 0, "desc" ]],
                    "iDisplayLength": 5,
                // "scrollY":        "60vh",
                // "scrollCollapse": true,
                // "paging":         false,
                // "stateSave": true,
                "dom": 'Bfrtip',
                // "buttons": [
                //     'copy', 'csv', 'excel', 'print'
                // ],
                "buttons": [
                {
                    extend: 'print'/*,
                    exportOptions: {
                        columns: [ 0,1,2,4,7,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34]
                    }*/
                },
                {
                    extend: 'excel',
                    text: 'Excel'/*,
                    exportOptions: {
                        columns: [ 0,1,2,4,7,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34]
                            // modifier: {
                            //     page: 'current'
                            // }
                        }*/
                    }
                    ,
                    {
                        extend: 'csv'/*,
                        exportOptions: {
                            columns: [ 0,1,2,4,7,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34]
                        }*/
                    }
                    ,
                    {
                        extend: 'copy'/*,
                        exportOptions: {
                            columns: [ 0,1,2,4,7,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34]
                        }*/
                    }
                    ],

                    "columnDefs": [
                    {
                        "targets": [ 1 ],
                        "visible": true,
                        "searchable": true
                    }
                    ,{
                        "targets": [ 2 ],
                        "visible": false
                    }
                    ,{
                        "targets": [ 3 ],
                        "visible": true
                    }
                    ,{
                        "targets": [ 4 ],
                        "visible": true
                    }
                    ,{
                        "targets": [ 5 ],
                        "visible": true
                    },{
                        "targets": [ 9 ],
                        "visible": false
                    }
                    ]
                } );

            // Apply the search
            table.columns().every( function () {
                var that = this;

                $( 'input', this.header() ).on( 'keyup change', function () {
                    // console.log(this.value);
                    if ( that.search(this.value) !== this.value ) {
                    //     console.log(that.search(this.value));
                    that.search( this.value ).draw();
                }
            } );
            } );


        } );



    </script>

<script type="text/javascript">
            $("#custom-caseDate").datepicker({
              dateFormat: "yy-mm-dd"
            });

            $("#custom-importDate").datepicker({
              dateFormat: "yy-mm-dd"
            });

            $("#custom-preCaseDate").datepicker({
              dateFormat: "yy-mm-dd"
            });

            $("#custom-preCaseCloseDate").datepicker({
              dateFormat: "yy-mm-dd"
            });

            $("#custom-preCaseCloseDate").datepicker({
              dateFormat: "yy-mm-dd"
            });

            $("#custom-caseCloseDate").datepicker({
              dateFormat: "yy-mm-dd"
            });
            
            $("#custom-chequeDate").datepicker({
              dateFormat: "yy-mm-dd"
            });
            $("#custom-dutyChequeDate").datepicker({
              dateFormat: "yy-mm-dd"
            });

</script>
